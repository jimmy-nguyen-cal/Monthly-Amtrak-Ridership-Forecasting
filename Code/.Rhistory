# trained model
lines(maa.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 0.5)
# Validation Data
nValid <- 36
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# multiplicative error with additive trend and additive seasonality model
maa <- ets(train.ts, model = "MAA")
# Forecasts
maa.pred <- forecast(maa, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(maa.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.2,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2010, 1), labels = format(seq(1991, 2010., 1)))
# trained model
lines(maa.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
# Validation Data
nValid <- 36
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# multiplicative error with additive trend and additive seasonality model
maa <- ets(train.ts, model = "MAA")
# Forecasts
maa.pred <- forecast(maa, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(maa.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.2,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2010, 1), labels = format(seq(1991, 2013, 1)))
# Validation Data
nValid <- 36
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# multiplicative error with additive trend and additive seasonality model
maa <- ets(train.ts, model = "MAA")
# Forecasts
maa.pred <- forecast(maa, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(maa.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.2,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(maa.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
library(astsa)
library(readr)
library(forecast)
library(zoo)
library(xts)
library(pander)
library(tidyverse)
library(tseries)
library(lubridate)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
# Load the data set from CSV file
df <- read_csv("../Data/Amtrak Ridership Data.csv")
# Rename columns
names(df)[1] <- 'Dates'
names(df[2]) <- 'Number_of_Passengers'
# First 12 months in 1991
head(df, n = 12) %>%
pander(style = "grid", caption = "First 12 Months - 1991")
# convert to time series object
df<- ts(data = df[,2], start = c(1991,1),
end = c(2013,5), frequency = 12)
print("Starting Year and Month: ")
start(df)
print("Final Year and Month: ")
end(df)
# Make a quick time-series plot
plot(df, xlab = "Year", ylab = "Number of Passengers",
bty = "l", col = "grey41",
main = "Amtrak Ridership, 1991-2013")
# Trailing Average
ma.trailing <- rollmean(df, k = 12, align = "right")
# Centered-Average
ma.centered <- ma(df, order = 12)
# Original Data
plot(df, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n", col = 'grey41',
main = "Centered vs. Trailing Moving Average")
# Labels
axis(1, at = seq(1991, 2013.50, 1), labels = format(seq(1991, 2013.50, 1)))
# Centered average lines
lines(ma.centered, lwd = 2, col = 'red')
# trailing moving average
lines(ma.trailing, lwd = 2, lty = 2, col ='blue')
# legend
legend(1991,2800000, c("Ridership","Centered Moving Average",
"Trailing Moving Average"), lty=c(1,1,2),
lwd=c(1,2,2), bty = "n", col = c("grey41", 'red', 'blue'))
# Validation Data
nValid <- 36
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# trailing moving average
ma.trailing <- rollmean(train.ts, k = 12, align = "right")
# last trailing moving average
last.ma <- tail(ma.trailing, 1)
# prediction by trailing moving average
ma.trailing.pred <- ts(rep(last.ma, nValid), start = c(1991, nTrain + 1),
end = c(1991, nTrain + nValid), freq = 12)
# plot
plot(train.ts, ylim = c(1300000, 2800000), ylab = "Ridership",
xlab = "Time", bty="l", xaxt = "n", col = 'grey41',
xlim = c(1991,2013.50), main = "Forecasting with Trailing Moving Average")
# labels
axis(1, at = seq(1991, 2013.50, 1), labels = format(seq(1991, 2013.50, 1)))
# training data
lines(ma.trailing, lwd = 2, col = "blue")
# validation data
lines(valid.ts, col = 'blue')
# predictions
lines(ma.trailing.pred, lwd = 2, col = "blue", lty = 2)
# Running the Dickey-Fuller Test on the original data without any pre-processing
adf.test(df)
par(mfrow=c(2,2))
# Original
plot(df, xlab = "Year", ylab = "Number of Passengers",
main = "Original Amtrak Ridership, 1991-2013", col = 'grey41')
# lag-12 difference
plot(diff(df, lag = 12), xlab = "Year", ylab = "Lag-12",
main = "Lag-12 Difference", col = 'blue')
# lag-1 difference
plot(diff(df), xlab = "Year", ylab = "Lag-1",
main = "Lag-1 Difference", col = 'red')
# Double Differencing
plot(diff(diff(df, s = 12)), xlab = "Year", ylab = "Lag-12, then Lag-1",
main = "Twice-DIfferenced (Lag-12, Lag-1)", col = 1)
# remove trend and seasonality by doing double-differencing
diff_twice <- diff(diff(df, lag = 12), lag = 1)
# Number of validation data
nValid <- 36
# number of training data
nTrain <- length(diff_twice) - nValid
# specified time window for training data
train.ts <- window(diff_twice, start = c(1992, 2), end = c(1992, nTrain + 1))
# specified time window for validation data
valid.ts <- window(diff_twice, start = c(1992, nTrain + 2),
end = c(1992, nTrain + 1 + nValid))
# Additive, no trend, no seasonality model using a constant (learning rate) of 0.2
ses <- ets(train.ts, model = "ANN", alpha = 0.2)
# make predictions using model
ses.pred <- forecast(ses, h = nValid, level = 0)
# plot predictions
plot(ses.pred, ylab = "Ridership (Twice-Differenced)", xlab = "Time",
bty = "l", xaxt = "n", xlim = c(1991,2013.50), main = "Simple Exponential Smoother on
Double Differenced Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# validaiton data
lines(valid.ts, col = "blue")
# model from training and validation data
lines(ses.pred$fitted, lwd = 2, col = "blue")
# Validation Data
nValid <- 36
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# multiplicative error with additive trend and additive seasonality model
maa <- ets(train.ts, model = "MAA")
# Forecasts
maa.pred <- forecast(maa, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(maa.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.2,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(maa.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
maa
maa
ets(train.ts, restrict = FALSE, allow.multiplicative.trend = TRUE)
# Validation Data
nValid <- 12
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# multiplicative error with additive trend and additive seasonality model
maa <- ets(train.ts, model = "MAA")
# Forecasts
maa.pred <- forecast(maa, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(maa.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.2,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(maa.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
# estimates and parameters
maa
# Validation Data
nValid <- 50
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# multiplicative error with additive trend and additive seasonality model
maa <- ets(train.ts, model = "MAA")
# Forecasts
maa.pred <- forecast(maa, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(maa.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.2,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(maa.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
# Validation Data
nValid <- 520
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# Validation Data
nValid <- 24
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# multiplicative error with additive trend and additive seasonality model
maa <- ets(train.ts, model = "MAA")
# Forecasts
maa.pred <- forecast(maa, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(maa.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.2,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(maa.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
# estimates and parameters
maa
ets(train.ts, restrict = FALSE, allow.multiplicative.trend = TRUE)
# Validation Data
nValid <- 24
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# multiplicative error with additive trend and additive seasonality model
maa <- ets(train.ts, model = "MAA")
# Forecasts
maa.pred <- forecast(maa, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(maa.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.5,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(maa.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
ets(train.ts, restrict = FALSE, allow.multiplicative.trend = TRUE)
#automated selection
optimal <- ets(train.ts, restrict = FALSE, allow.multiplicative.trend = TRUE)
#automated selection - optimal model
optimal <- ets(train.ts, restrict = FALSE, allow.multiplicative.trend = TRUE)
optimal
# Optimal Forecasts
op.pred <- forecast(optimal, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(op.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.5,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(op.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
# Optimal Forecasts
op.pred <- forecast(optimal, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(op.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.5,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(op.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
# Optimal Forecasts
op.pred <- forecast(optimal, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(op.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.5,
main = "ANM Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(op.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
library(astsa)
library(readr)
library(forecast)
library(zoo)
library(xts)
library(pander)
library(tidyverse)
library(tseries)
library(lubridate)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
# Load the data set from CSV file
df <- read_csv("../Data/Amtrak Ridership Data.csv")
# Rename columns
names(df)[1] <- 'Dates'
names(df[2]) <- 'Number_of_Passengers'
# First 12 months in 1991
head(df, n = 12) %>%
pander(style = "grid", caption = "First 12 Months - 1991")
# convert to time series object
df<- ts(data = df[,2], start = c(1991,1),
end = c(2013,5), frequency = 12)
print("Starting Year and Month: ")
start(df)
print("Final Year and Month: ")
end(df)
# Make a quick time-series plot
plot(df, xlab = "Year", ylab = "Number of Passengers",
bty = "l", col = "grey41",
main = "Amtrak Ridership, 1991-2013")
# Trailing Average
ma.trailing <- rollmean(df, k = 12, align = "right")
# Centered-Average
ma.centered <- ma(df, order = 12)
# Original Data
plot(df, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n", col = 'grey41',
main = "Centered vs. Trailing Moving Average")
# Labels
axis(1, at = seq(1991, 2013.50, 1), labels = format(seq(1991, 2013.50, 1)))
# Centered average lines
lines(ma.centered, lwd = 2, col = 'red')
# trailing moving average
lines(ma.trailing, lwd = 2, lty = 2, col ='blue')
# legend
legend(1991,2800000, c("Ridership","Centered Moving Average",
"Trailing Moving Average"), lty=c(1,1,2),
lwd=c(1,2,2), bty = "n", col = c("grey41", 'red', 'blue'))
# Validation Data
nValid <- 36
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# trailing moving average
ma.trailing <- rollmean(train.ts, k = 12, align = "right")
# last trailing moving average
last.ma <- tail(ma.trailing, 1)
# prediction by trailing moving average
ma.trailing.pred <- ts(rep(last.ma, nValid), start = c(1991, nTrain + 1),
end = c(1991, nTrain + nValid), freq = 12)
# plot
plot(train.ts, ylim = c(1300000, 2800000), ylab = "Ridership",
xlab = "Time", bty="l", xaxt = "n", col = 'grey41',
xlim = c(1991,2013.50), main = "Forecasting with Trailing Moving Average")
# labels
axis(1, at = seq(1991, 2013.50, 1), labels = format(seq(1991, 2013.50, 1)))
# training data
lines(ma.trailing, lwd = 2, col = "blue")
# validation data
lines(valid.ts, col = 'blue')
# predictions
lines(ma.trailing.pred, lwd = 2, col = "blue", lty = 2)
# Running the Dickey-Fuller Test on the original data without any pre-processing
adf.test(df)
par(mfrow=c(2,2))
# Original
plot(df, xlab = "Year", ylab = "Number of Passengers",
main = "Original Amtrak Ridership, 1991-2013", col = 'grey41')
# lag-12 difference
plot(diff(df, lag = 12), xlab = "Year", ylab = "Lag-12",
main = "Lag-12 Difference", col = 'blue')
# lag-1 difference
plot(diff(df), xlab = "Year", ylab = "Lag-1",
main = "Lag-1 Difference", col = 'red')
# Double Differencing
plot(diff(diff(df, s = 12)), xlab = "Year", ylab = "Lag-12, then Lag-1",
main = "Twice-DIfferenced (Lag-12, Lag-1)", col = 1)
# remove trend and seasonality by doing double-differencing
diff_twice <- diff(diff(df, lag = 12), lag = 1)
# Number of validation data
nValid <- 36
# number of training data
nTrain <- length(diff_twice) - nValid
# specified time window for training data
train.ts <- window(diff_twice, start = c(1992, 2), end = c(1992, nTrain + 1))
# specified time window for validation data
valid.ts <- window(diff_twice, start = c(1992, nTrain + 2),
end = c(1992, nTrain + 1 + nValid))
# Additive, no trend, no seasonality model using a constant (learning rate) of 0.2
ses <- ets(train.ts, model = "ANN", alpha = 0.2)
# make predictions using model
ses.pred <- forecast(ses, h = nValid, level = 0)
# plot predictions
plot(ses.pred, ylab = "Ridership (Twice-Differenced)", xlab = "Time",
bty = "l", xaxt = "n", xlim = c(1991,2013.50), main = "Simple Exponential Smoother on
Double Differenced Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# validaiton data
lines(valid.ts, col = "blue")
# model from training and validation data
lines(ses.pred$fitted, lwd = 2, col = "blue")
# Validation Data
nValid <- 24
# Training data
nTrain <- length(df) - nValid
# time window for training data
train.ts <- window(df, start = c(1991, 1), end = c(1991, nTrain))
# time window for validation data
valid.ts <- window(df, start = c(1991, nTrain + 1), end = c(1991, nTrain + nValid))
# multiplicative error with additive trend and additive seasonality model
maa <- ets(train.ts, model = "MAA")
# Forecasts
maa.pred <- forecast(maa, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(maa.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.5,
main = "Additive Trend and Additive Seasonality Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(maa.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
# estimates and parameters
maa
#automated selection - optimal model
optimal <- ets(train.ts, restrict = FALSE, allow.multiplicative.trend = TRUE)
optimal
# Optimal Forecasts
op.pred <- forecast(optimal, h = nValid, level = 0)
# plot training, validation, and forecasts
plot(op.pred, ylab = "Ridership", xlab = "Time",
bty = "l", xaxt = "n",col = 'black', lwd =1.5,
main = "ANM Model on Original
Data", flty = 2)
# labels
axis(1, at = seq(1991, 2013, 1), labels = format(seq(1991, 2013, 1)))
# trained model
lines(op.pred$fitted, lwd = 1.2, col = "blue")
# validation data
lines(valid.ts, col = 'black', lwd = 1.2)
